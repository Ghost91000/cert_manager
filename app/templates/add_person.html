{% extends "base.html" %}
{% block content %}
    <h1>Добавить пользователя</h1>

    <form>
        <input type="hidden" id="mode" value="add">
        <input type="hidden" id="edit_id" value="">

        <input id="name" type="text" name="name" placeholder="Имя" required><br><br>
        <input id="phone" type="phone" name="phone" placeholder="Phone" required><br><br>
        <input id="email" type="email" name="email" placeholder="Email" required><br><br>
        <button id="btn_add" onclick="add()">Добавить</button>
        <button style="display: none; background-color: #dc3545" id="btn_clear" onclick="clearing()">Отмена</button>
    </form>
    <div id="list-person">
        {% include "list_person_partical.html" %}
    </div>
    <div style="margin-top: 20px;">
        <button onclick="refreshTable()">Обновить таблицу</button>
    </div>
    <br>

     <script>
         async function delete_person(id) {
                const response = await fetch('/delete_person', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `id=${encodeURIComponent(id)}`
                });
                refreshTable()
         }

         async function edit_pc(id){
            const response = await fetch(`/edit_person/${id}`);
            const data = await response.json();

            document.getElementById('name').value = data.name;
            document.getElementById('phone').value = data.phone;
            document.getElementById('email').value = data.email;

            document.getElementById('btn_add').textContent = "Изменить";
            document.getElementById('mode').value = "edit";
            document.getElementById('edit_id').value = id;
            document.getElementById('btn_clear').style.display = 'inline-block';

        }

        async function add() {
            const data = {
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
            }

            let url, method;
            let mode = document.getElementById('mode').value
            let edit_id = document.getElementById('edit_id').value

            if (mode === "add") {
                url = '/add_person'
                method = 'POST'
            } else {
                url = `/edit_person/${edit_id}`
                method = 'PUT'
            }

            const response = await fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
                });
        }

        // Функция обновления таблицы
        async function refreshTable() {
            const response = await fetch('/list_person_partical');
            const html = await response.text();
            document.getElementById('list-person').innerHTML = html;
        }
    </script>
{% endblock %}
